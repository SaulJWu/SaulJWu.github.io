(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{662:function(t,a,s){"use strict";s.r(a);var e=s(15),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("在分布式开发中，需要一个API网关，它扮演着至关重要的角色，具有路由，过滤，限流，监控，日志输出等等作用。")]),t._v(" "),s("p",[t._v("假设我们需要对商品的增删改查，就需要发布请求到商品服务的端口，当存在多个机器上线商品服务，只有1号机器上线时，我们需要发送请求到1号机器的端口，只有2号机器上线时，我们需要发送请求到2号机器端口，当商品服务有十几个机器上线时，某一个用不了，还需要动态切换到可用的机器端口，我们不可能去后台管理系统去修改发送的端口。")]),t._v(" "),s("p",[t._v("当所有请求经过网关，网关实时感知哪个端口可用，转发到真实端口。")]),t._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[t._v("Gateway是在Spring生态系统之上构建的API网关服务，基于Spring 5，Spring Boot 2和 Project Reactor等技术。Gateway旨在提供一种简单而有效的方式来对API进行路由，以及提供一些强大的过滤器功能， 例如：熔断、限流、重试等。")]),t._v(" "),s("p",[t._v("Spring Cloud Gateway 具有如下特性：")]),t._v(" "),s("ul",[s("li",[t._v("基于Spring Framework 5, Project Reactor 和 Spring Boot 2.0 进行构建；")]),t._v(" "),s("li",[t._v("动态路由：能够匹配任何请求属性；")]),t._v(" "),s("li",[t._v("可以对路由指定 Predicate（断言）和 Filter（过滤器）；")]),t._v(" "),s("li",[t._v("集成Hystrix的断路器功能；")]),t._v(" "),s("li",[t._v("集成 Spring Cloud 服务发现功能；")]),t._v(" "),s("li",[t._v("易于编写的 Predicate（断言）和 Filter（过滤器）；")]),t._v(" "),s("li",[t._v("请求限流功能；")]),t._v(" "),s("li",[t._v("支持路径重写。")])]),t._v(" "),s("p",[t._v("网关作为流量的入口，常用功能包括路由转发、权限校验、限流控制等。而SpringCloud Gateway作为SpringCloud官方推出的第二代网关框架，取代了Zuul网关。")]),t._v(" "),s("p",[t._v("在网上有简单的性能测试性能：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("组件")]),t._v(" "),s("th",[t._v("RPS(request per second)")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("SpringCloud Gateway")]),t._v(" "),s("td",[t._v("Requests/sec:32213.38")])]),t._v(" "),s("tr",[s("td",[t._v("Zuul")]),t._v(" "),s("td",[t._v("Requests/sec:20800.13")])]),t._v(" "),s("tr",[s("td",[t._v("Linkerd")]),t._v(" "),s("td",[t._v("Requests/sec:28050.76")])])])]),t._v(" "),s("p",[t._v("SpringCloud Gateway 每秒能处理三万多请求，比其他2个强多了。")]),t._v(" "),s("h2",{attrs:{id:"学习文档"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#学习文档"}},[t._v("#")]),t._v(" 学习文档")]),t._v(" "),s("blockquote",[s("p",[t._v("官方文档")])]),t._v(" "),s("p",[t._v("https://spring.io/projects/spring-cloud-gateway")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141542.png",alt:"image-20201001233623244"}})]),t._v(" "),s("p",[s("code",[t._v("CURRENT")]),t._v(" "),s("code",[t._v("GA")]),t._v("就是稳定发布的版本，点击Reference Doc就可以查看详细文档。")]),t._v(" "),s("h2",{attrs:{id:"相关概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关概念"}},[t._v("#")]),t._v(" 相关概念")]),t._v(" "),s("blockquote",[s("h2",{attrs:{id:"_2-glossary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-glossary"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://docs.spring.io/spring-cloud-gateway/docs/2.2.5.RELEASE/reference/html/#glossary",target:"_blank",rel:"noopener noreferrer"}},[t._v("2. Glossary"),s("OutboundLink")],1)]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Route")]),t._v(": The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates, and a collection of filters. A route is matched if the aggregate predicate is true.")]),t._v(" "),s("li",[s("strong",[t._v("Predicate")]),t._v(": This is a "),s("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java 8 Function Predicate"),s("OutboundLink")],1),t._v(". The input type is a "),s("a",{attrs:{href:"https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Framework "),s("code",[t._v("ServerWebExchange")]),s("OutboundLink")],1),t._v(". This lets you match on anything from the HTTP request, such as headers or parameters.")]),t._v(" "),s("li",[s("strong",[t._v("Filter")]),t._v(": These are instances of "),s("a",{attrs:{href:"https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Framework "),s("code",[t._v("GatewayFilter")]),s("OutboundLink")],1),t._v(" that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request.")])])]),t._v(" "),s("p",[t._v("Route（路由）：路由是构建网关的基本模块，它由ID，目标URI，一系列的断言和过滤器组成，如果断言为true则匹配该路由；")]),t._v(" "),s("p",[t._v("Predicate（断言）：指的是Java 8 的 Function Predicate。 输入类型是Spring框架中的ServerWebExchange。 这使开发人员可以匹配HTTP请求中的所有内容，例如请求头或请求参数。如果请求与断言相匹配，则进行路由；")]),t._v(" "),s("p",[t._v("Filter（过滤器）：指的是Spring框架中GatewayFilter的实例，使用过滤器，可以在请求被路由前后对请求进行修改。")]),t._v(" "),s("h2",{attrs:{id:"工作流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#工作流程"}},[t._v("#")]),t._v(" 工作流程")]),t._v(" "),s("p",[t._v("客户端想要发请求到目标服务端，中间会经过网关")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141536",alt:"img"}})]),t._v(" "),s("blockquote",[s("p",[t._v("请求")])]),t._v(" "),s("ol",[s("li",[t._v("客户端发请求")]),t._v(" "),s("li",[t._v("请求到达API网关（Spring Cloud Gateway）")]),t._v(" "),s("li",[t._v("Gateway Handler Mapping处理，映射信息将会被检查，能否被路由或者被处理")]),t._v(" "),s("li",[t._v("如果能处理，就会交给Handler处理器处理")]),t._v(" "),s("li",[t._v("处理器处理这些请求，就会经过一系列的filter")]),t._v(" "),s("li",[t._v("filter过滤结束后，就会把这个请求路由给指定的服务")])]),t._v(" "),s("blockquote",[s("p",[t._v("返回")])]),t._v(" "),s("p",[t._v("服务端处理完毕后，也会经过上面的一系列过滤，返回给客户端")]),t._v(" "),s("h2",{attrs:{id:"新建网关微服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建网关微服务"}},[t._v("#")]),t._v(" 新建网关微服务")]),t._v(" "),s("h3",{attrs:{id:"新建模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建模块"}},[t._v("#")]),t._v(" 新建模块")]),t._v(" "),s("p",[t._v("root项目>>new Moudle>>Spring Initializr")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141519.png",alt:"image-20201002110256663"}})]),t._v(" "),s("ul",[s("li",[t._v("搜索gateway，选中依赖，点击下一步，完成")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141515.png",alt:"image-20201002110401455"}})]),t._v(" "),s("h3",{attrs:{id:"依赖common模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#依赖common模块"}},[t._v("#")]),t._v(" 依赖common模块")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.elite.mall"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("elitemall-common"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("0.0.1-SNAPSHOT"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h3",{attrs:{id:"把网关服务注册到注册中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#把网关服务注册到注册中心"}},[t._v("#")]),t._v(" 把网关服务注册到注册中心")]),t._v(" "),s("ul",[s("li",[t._v("设置应用名字application.properties")])]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.nacos.discovery.server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1:8848")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.application.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("elitemall-gateway")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("88")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"为网关新建nacos命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为网关新建nacos命名空间"}},[t._v("#")]),t._v(" 为网关新建nacos命名空间")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141510.png",alt:"image-20201002111803753"}})]),t._v(" "),s("h3",{attrs:{id:"在网关命名空间新建配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在网关命名空间新建配置"}},[t._v("#")]),t._v(" 在网关命名空间新建配置")]),t._v(" "),s("ul",[s("li",[t._v("Data Id：elitemall-gateway.yml")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/images/20210422014437.png",alt:"image-20201002112114470"}})]),t._v(" "),s("h3",{attrs:{id:"将网关微服务使用刚才创建的命名空间"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将网关微服务使用刚才创建的命名空间"}},[t._v("#")]),t._v(" 将网关微服务使用刚才创建的命名空间")]),t._v(" "),s("ul",[s("li",[t._v("bootstrap.properties")])]),t._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.nacos.config.server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1:8848")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.nacos.config.namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("9512e348-2216-4b9d-99e1-e230fed7faf8")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h4",{attrs:{id:"验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),s("p",[t._v("启动网关微服务，看看能否正常注册到注册中心。")]),t._v(" "),s("p",[t._v("发现报错")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("ction"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\nConsider the following"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\tIf you want an embedded database (H2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HSQL or Derby)"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" please put it on the classpath.\n\tIf you have database settings to be loaded from a particular profile you may need to activate it (no profiles are currently active).\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("因为网关微服务暂时还用不到数据源，所以启动时要排除掉。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autoconfigure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringBootApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autoconfigure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataSourceAutoConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("discovery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableDiscoveryClient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableDiscoveryClient")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exclude "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataSourceAutoConfiguration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElitemallGatewayApplication")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElitemallGatewayApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("p",[t._v("重新启动微服务，访问88接口，已经能够访问。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://raw.githubusercontent.com/SaulJWu/images/main/20201117141459.png",alt:"image-20201002120855385"}})]),t._v(" "),s("h2",{attrs:{id:"两种不同的配置路由方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#两种不同的配置路由方式"}},[t._v("#")]),t._v(" 两种不同的配置路由方式")]),t._v(" "),s("blockquote",[s("p",[t._v("Gateway 提供了两种不同的方式用于配置路由，一种是通过yml文件来配置，另一种是通过Java Bean来配置，")]),t._v(" "),s("p",[t._v("参考资料：https://juejin.im/post/6844903982599684103")])]),t._v(" "),s("h2",{attrs:{id:"the-query-route-predicate-factory-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-query-route-predicate-factory-测试"}},[t._v("#")]),t._v(" The "),s("code",[t._v("Query")]),t._v(" route predicate factory 测试")]),t._v(" "),s("blockquote",[s("p",[t._v("The preceding route matches if the request contained a "),s("code",[t._v("red")]),t._v(" query parameter whose value matched the "),s("code",[t._v("gree.")]),t._v(" regexp, so "),s("code",[t._v("green")]),t._v(" and "),s("code",[t._v("greet")]),t._v(" would match.")])]),t._v(" "),s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test_route\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//translate.google.cn/\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Query=url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("translate\n\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" qq_route\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//www.qq.com/\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Query=url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("qq\n\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" baidu_route\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//www.baidu.com/\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Query=url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("baidu\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br")])]),s("p",[t._v("重启网关微服务，分别测试")]),t._v(" "),s("ul",[s("li",[t._v("http://localhost:88/hello?url=translate")]),t._v(" "),s("li",[t._v("http://localhost:88/hello?url=qq")]),t._v(" "),s("li",[t._v("http://localhost:88/hello?url=baidu")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/images/20210422014451.png",alt:"image-20201002124420138"}})]),t._v(" "),s("p",[t._v("会发现全部跳转到404，但是实际上已经成功了，因为相当于范围qq.com/hello，所以就跳转到404")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("当请求到达网关，网关先利用断言（Predicate）来判定这次请求是否符合某个路由规则，如果符合，则按路由（Route）规则路由到指定地方，但要去这些指定地方，要经过一系列的过滤（Filter）")])])}),[],!1,null,null,null);a.default=n.exports}}]);