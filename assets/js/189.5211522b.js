(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{526:function(s,a,e){"use strict";e.r(a);var t=e(20),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"zabbix专有词汇"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zabbix专有词汇"}},[s._v("#")]),s._v(" zabbix专有词汇")]),s._v(" "),e("p",[s._v("对于英文的掌握，是IT人员必须学习的技能，以下是zabbix必须掌握的一些关键词。")]),s._v(" "),e("ul",[e("li",[s._v("zabbix server，服务端，收集数据，写入数据")]),s._v(" "),e("li",[s._v("Item，对于某一个监控指标，称之为Items，如某台服务器的内存使用状况，就是一个item监控项")]),s._v(" "),e("li",[s._v("Trigger，触发器，定义报警的逻辑，有正常，异常，未知三个状态")]),s._v(" "),e("li",[s._v("Action，当Trigger符合设定值后，zabbix指定的动作，如发个邮件")])]),s._v(" "),e("h2",{attrs:{id:"zabbix程序组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zabbix程序组件"}},[s._v("#")]),s._v(" zabbix程序组件")]),s._v(" "),e("ul",[e("li",[s._v("zabbix_server")]),s._v(" "),e("li",[s._v("zabbix_agentd")]),s._v(" "),e("li",[s._v("zabbix_proxy")]),s._v(" "),e("li")]),s._v(" "),e("h2",{attrs:{id:"部署zabbix-5-0"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署zabbix-5-0"}},[s._v("#")]),s._v(" 部署zabbix 5.0")]),s._v(" "),e("h3",{attrs:{id:"部署zabbix服务端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署zabbix服务端"}},[s._v("#")]),s._v(" 部署zabbix服务端")]),s._v(" "),e("blockquote",[e("p",[s._v("1、准备机器，环境初始化")])]),s._v(" "),e("ul",[e("li",[s._v("获取ip")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("ipconfig\n\nipconfig eth0\n\nipconfig eht0 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NR==2{print $2}'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("ul",[e("li",[s._v("关闭防火墙")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/SELINUX=enforcing/SELINUX=disabled/'")]),s._v(" /etc/selinux/config\nsystemctl disable --now firewalld\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看可接受流量")]),s._v("\niptables -L\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("2、zabbix-server至少4G硬盘，尽量大一些。")])]),s._v(" "),e("ul",[e("li",[s._v("查看硬盘")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("3、获取zabbix的下载源")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看仓库文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /etc/yum.repos.d/\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开配置信息，改为阿里云")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("4、更换zabix.repo为阿里云源")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#http://repo.zabbix.com#https://mirros.aliyun.com/zabbix#'")]),s._v(" /etc/yum.repos.d/zabbix.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("更换不会有反馈，需要自己打开配置文件查看")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/yum.repos.d/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("5、清空yum旧缓存，下载zabbix服务端")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum clean all\nyum makecache\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zabbix-server-mysql zabbix-agent -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("6、安装软件搜索器，可以在机器上使用多个版本的软件，并且不会影响到系统的依赖环境")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" centos-release-scl -y^C\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("7、修改zabbix-front前端源，修改如下参数")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/yum.repos.d/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"C:%5CUsers%5CSaulJ%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220228144306452.png",alt:"image-20220228144306452"}})]),s._v(" "),e("p",[s._v("参数如下：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把enabled改为1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("8、安装zabbix前端环境，且是安装到scl环境下")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zabbix-web-mysql-scl zabbix-apache-conf-scl -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("9、安装zabbix所需的数据，mariadb")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mariadb-server -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("10、配置数据库开机启动，并且立刻启动")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" --now mariadb\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("11、初始化数据库设置密码")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl status mariadb\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码，默认为空")]),s._v("\nmysql-secure-installation\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否要移除用户，是的")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止root远程登录，否")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("blockquote",[e("p",[s._v("12、添加数据库，并且添加zabbix专用用户")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mysql -uroot -p\n\nshow databases"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建数据库")]),s._v("\ncreate database zabbix character "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" utf8 collate utf_bin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加用户 localhost是指允许本机登录")]),s._v("\ncreate user zabbix@localhost identified by "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你想要的密码'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权")]),s._v("\ngrant all privileges on zabbix.* to zabbix@localhost"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 刷新授权表")]),s._v("\nflush privileges"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("blockquote",[e("p",[s._v("13、使用zabbix-mysql命令，导入数据库信息")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -uzabbix -pzabbix zabbix\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("mysql -u后面是用户，-p是密码，空格后面是数据库名")]),s._v(" "),e("p",[s._v("导入完成后，进入数据库，查看有哪些表，检查是否导入成功")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mysql -uroot -p\n\nshow databases"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nuse zabbix"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nshow tables"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("如果导入成功的话，这些表都会创建成功。")]),s._v(" "),e("blockquote",[e("p",[s._v("14、修改zabbix-server配置文件，修改数据库的密码")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/zabbix/zabbix_server.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("检查一下")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^DBPa'")]),s._v(" /etc/zabbix/zabbix_server.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("15、修改zabbix的php配置文件，修改时区"),e("code",[s._v("Asia/Shanghai")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("检查一下")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'timezone'")]),s._v(" /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("16、启动zabbix相关服务器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" zabbix-server zabbix-agent httpd rh-php72-php-fpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("17、访问zabbix入口")])]),s._v(" "),e("p",[s._v("访问端口测试一下：")]),s._v(" "),e("p",[s._v("ip+"),e("code",[s._v("/zabbix")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202202281644829.png",alt:"image-20220228164212913"}})]),s._v(" "),e("p",[s._v("配置数据库")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202202281645987.png",alt:"image-20220228164506883"}})]),s._v(" "),e("p",[s._v("细节设置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202202281645871.png",alt:"image-20220228164524785"}})]),s._v(" "),e("ul",[e("li",[s._v("显示安装细节")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202202281645952.png",alt:"image-20220228164541870"}})]),s._v(" "),e("p",[s._v("安装成功")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202202281645448.png",alt:"image-20220228164557357"}})]),s._v(" "),e("blockquote",[e("p",[s._v("18、安装成功后默认账号密码")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("Admin\nzabbix\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("19.设置zabbix网页端中文")])]),s._v(" "),e("ul",[e("li",[s._v("user-settings")]),s._v(" "),e("li",[s._v("Language选择中文")]),s._v(" "),e("li",[s._v("update")])]),s._v(" "),e("p",[s._v("还有就是zabbix的仪表板，都可以自定义拖动组件和大小")]),s._v(" "),e("h3",{attrs:{id:"部署zabbix客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署zabbix客户端"}},[s._v("#")]),s._v(" 部署zabbix客户端")]),s._v(" "),e("p",[s._v("zabbix5.0版本")]),s._v(" "),e("p",[s._v("agent新版本采用golang语言开发的客户端")]),s._v(" "),e("p",[s._v("由于是go语言开发，部署起来就很方便了，和之前的部署形式不一样了")]),s._v(" "),e("p",[s._v("agent2默认用10050端口，也就是zabbix客户端的端口")]),s._v(" "),e("ul",[e("li",[s._v("旧版本的客户端，zabbix-agent")]),s._v(" "),e("li",[s._v("go语言新版客户端，zabbix-agent2")])]),s._v(" "),e("blockquote",[e("p",[s._v("1.机器环境准备，2台zabbix客户端")])]),s._v(" "),e("ul",[e("li",[s._v("linux-2,zabbix-agent2")]),s._v(" "),e("li",[s._v("linux-3,zabbix-agent2")])]),s._v(" "),e("blockquote",[e("p",[s._v("2.注意时间正确")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate -y\nntpdate -u ntp.aliyun.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("3.时区的统一配置")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查时间是否一致")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/lcaoltime"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(",.bak"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"验证zaabix-agent2的连通性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证zaabix-agent2的连通性"}},[s._v("#")]),s._v(" 验证zaabix-agent2的连通性")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code")]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"})]),e("h3",{attrs:{id:"解决zaabix-server查看的乱码问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决zaabix-server查看的乱码问题"}},[s._v("#")]),s._v(" 解决zaabix-server查看的乱码问题")]),s._v(" "),e("ul",[e("li",[s._v("检测->主机,zabbix默认检测的就是它自己的服务端")])]),s._v(" "),e("p",[s._v("zabbix默认检测了服务端本身，但是编码有问题")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装字体\nyum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" wqy-microhei-fonts\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".复制字体\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /usr/share/fonts/dejavu/DejaVuSans.ttf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"添加zabbix-agent主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加zabbix-agent主机"}},[s._v("#")]),s._v(" 添加zabbix-agent主机")]),s._v(" "),e("blockquote",[e("p",[s._v("模板")])]),s._v(" "),e("ul",[e("li",[s._v("我们添加监控项的时候可以直接使用模板，不需要每一个监控项都自己手动添加。")]),s._v(" "),e("li",[s._v("我们只需要选择模板")])]),s._v(" "),e("p",[s._v("操作：菜单->报表->主机")]),s._v(" "),e("ol",[e("li",[s._v("点击创建主机\n"),e("ol",[e("li",[s._v("主机名称：尽量和Linux hostname保持一致")]),s._v(" "),e("li",[s._v("可见的名称：在平台上看见的名称，为了通俗易懂，可以使用hostname+ip地址")]),s._v(" "),e("li",[s._v("群组：Linux servers，把当前加入到Linux主机群组")]),s._v(" "),e("li",[s._v("客户端Ip：填写IP")]),s._v(" "),e("li",[s._v("DNS名称：不用管，没用到")]),s._v(" "),e("li",[s._v("端口：默认是10050")]),s._v(" "),e("li",[s._v("描述：备注信息")]),s._v(" "),e("li",[s._v("代理程序：不用管")])])])]),s._v(" "),e("p",[s._v("创建完主机后，发现可用性那一列，没一个是绿色的，接下来需要操作：")]),s._v(" "),e("ol",[e("li",[s._v("编辑主机")]),s._v(" "),e("li",[s._v("选择模板")]),s._v(" "),e("li",[s._v("输入Linux，自动搜索出许多模板")]),s._v(" "),e("li",[s._v("可以使用"),e("code",[s._v("Template OS linux By Zabbix agent")])])]),s._v(" "),e("p",[s._v("等待"),e("code",[s._v("ZBX")]),s._v("亮了之后，才算是正常的")]),s._v(" "),e("h2",{attrs:{id:"自定义监控内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义监控内容"}},[s._v("#")]),s._v(" 自定义监控内容")]),s._v(" "),e("h3",{attrs:{id:"从命令行角度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从命令行角度"}},[s._v("#")]),s._v(" 从命令行角度")]),s._v(" "),e("blockquote",[e("p",[s._v("从zabbix-server就可以获取zabbix-agent端的数据")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否能连接指定机器")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'agent.ping'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定机器内核信息")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'system.uname'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定机器的名字")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'system.hostname'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取指定机器的指定目录容量占用")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("vfs.fs.size"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/,used"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取指定机器的指定目录总大小")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("vfs.fs.size"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/,total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定的key")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10050")]),s._v(" -k "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'login.user'")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看zabbix检查自带的登录机器人数")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("p",[s._v("如果是错误命令，控制行会报错误"),e("code",[s._v("ZBX_NOTSUPPORTED: Unkown metric xxxx")])]),s._v(" "),e("blockquote",[e("p",[s._v("zabbix-agent端查看有多少登录人数")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("who")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看zabbix配置文件")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/zabbix/zabbix_agent2.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"全网监控的方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全网监控的方案"}},[s._v("#")]),s._v(" 全网监控的方案")]),s._v(" "),e("ul",[e("li",[s._v("如何快速添加n台机器")])]),s._v(" "),e("p",[s._v("思路：")]),s._v(" "),e("ol",[e("li",[s._v("克隆监控模板")]),s._v(" "),e("li",[s._v("自动注册和自动发现")]),s._v(" "),e("li",[s._v("使用zabbix的api接口，利用curl语言，或者开发自己的编程脚本如python等")])]),s._v(" "),e("p",[s._v("我们日常使用的各种软件，都是提供了API接口，给开发人员进行修改以及获取数据的。")]),s._v(" "),e("p",[s._v("接口的定义。")]),s._v(" "),e("h3",{attrs:{id:"监控实施方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控实施方案"}},[s._v("#")]),s._v(" 监控实施方案")]),s._v(" "),e("blockquote",[e("p",[s._v("从硬件监控角度")])]),s._v(" "),e("p",[s._v("配置->模板，可以发现zabbix自带的模板已经包含了常用的监控项")]),s._v(" "),e("blockquote",[e("p",[s._v("应用服务监控")])]),s._v(" "),e("p",[s._v("有关端口的监控，使用zabbix自带的key,"),e("code",[s._v("net.tcp.port[,8080]")])]),s._v(" "),e("ul",[e("li",[e("p",[s._v("rsync服务监控")]),s._v(" "),e("ul",[e("li",[s._v("监控服务器的873端口是存活的")]),s._v(" "),e("li",[s._v("通过key检测873端口,"),e("code",[s._v("net.tcp.port[,873]")])]),s._v(" "),e("li",[s._v("进行数据推拉，检测效果")])])]),s._v(" "),e("li",[e("p",[s._v("监控NFS服务是否正常")]),s._v(" "),e("ul",[e("li",[s._v("通过key检测111端口,"),e("code",[s._v("net.tcp.port[,111]")])]),s._v(" "),e("li",[e("code",[s._v("showmount -e ip | wc -l")])])])]),s._v(" "),e("li",[e("p",[s._v("监控mysql数据库是否正常")]),s._v(" "),e("ul",[e("li",[s._v("通过key检测3306端口,"),e("code",[s._v("net.tcp.port[,3306]")]),s._v(" "),e("ul",[e("li",[s._v("链接：mysql -uroot -p")])])]),s._v(" "),e("li",[s._v("zabbix自带mysql的监控模板，直接添加模板和mysql的主机关联即可")])])]),s._v(" "),e("li",[e("p",[s._v("web服务器监控")]),s._v(" "),e("ul",[e("li",[s._v("通过key检测8080端口,"),e("code",[s._v("net.tcp.port[,8080]")])]),s._v(" "),e("li",[s._v("zabbix也提供了对web服务器的监控模板")])])])]),s._v(" "),e("blockquote",[e("p",[s._v("互联网上有大量的监控模板")])]),s._v(" "),e("h3",{attrs:{id:"监控服务的具体方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控服务的具体方法"}},[s._v("#")]),s._v(" 监控服务的具体方法")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口检测的命令")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v("\nss\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结合grep查看端口是否存货")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在zabbix服务端")]),s._v("\nzabbix_get -s "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'IP'")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("port"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" - k "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bash'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("查看进程信息")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("通过客户端连接")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("web服务器用 curl查询\nmysql 用sql语句连接验证\n缓存数据库服务 数据读写验证\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"zabbix自动发现-自动注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zabbix自动发现-自动注册"}},[s._v("#")]),s._v(" zabbix自动发现，自动注册")]),s._v(" "),e("ol",[e("li",[s._v("准备好一台客户端机器，用来演示自动发现，自动注册")]),s._v(" "),e("li",[s._v("练习")])]),s._v(" "),e("h4",{attrs:{id:"什么是自动发现-自动注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是自动发现-自动注册"}},[s._v("#")]),s._v(" 什么是自动发现，自动注册")]),s._v(" "),e("blockquote",[e("p",[s._v("自动发现（agent2是被动模式）")])]),s._v(" "),e("p",[s._v("zabbix server主动的去发现所有的客户端，然后将客户端的信息，登记在服务端的机器上。")]),s._v(" "),e("p",[s._v("缺点是，zabbix-server压力会比较大")]),s._v(" "),e("p",[s._v("如果说你定义了一个网段100~200网段，耗时较久，且压力大")]),s._v(" "),e("blockquote",[e("p",[s._v("自动注册（agent2是主动模式）")])]),s._v(" "),e("p",[s._v("zabbix agent2主动上报自己的信息，发给zabbix-server")]),s._v(" "),e("p",[s._v("缺点是agent2可能找不到server（配置文件写错了，网络不通）")]),s._v(" "),e("blockquote",[e("p",[s._v("被动模式，主动模式的区别（站在agent2立场）")])]),s._v(" "),e("ul",[e("li",[s._v("被动模式，对于agent2就是server来找agent2拿数据")]),s._v(" "),e("li",[s._v("主动模式，agent2主动把数据发给server")])]),s._v(" "),e("h3",{attrs:{id:"自动发现配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自动发现配置"}},[s._v("#")]),s._v(" 自动发现配置")]),s._v(" "),e("h4",{attrs:{id:"配置host解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置host解析"}},[s._v("#")]),s._v(" 配置host解析")]),s._v(" "),e("p",[s._v("在服务端和客户端都要配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开host文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/host\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务端")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.10 tech_linux3\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.12 zbx-agent05\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ul",[e("li",[s._v("创建发现规则")])]),s._v(" "),e("p",[s._v("进入zabbix服务端web配置->自动发现->创建发现规则")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041011440.png",alt:"image-20220304101109275"}})]),s._v(" "),e("ul",[e("li",[s._v("配置->动作")])]),s._v(" "),e("p",[s._v("启用发现动作")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041012632.png",alt:"image-20220304101200508"}})]),s._v(" "),e("ul",[e("li",[s._v("当自动发现配置，可以检测服务端的日志")])]),s._v(" "),e("h3",{attrs:{id:"自动注册配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自动注册配置"}},[s._v("#")]),s._v(" 自动注册配置")]),s._v(" "),e("p",[s._v("流程：")]),s._v(" "),e("ul",[e("li",[s._v("准备机器server和agent")]),s._v(" "),e("li",[s._v("修改agent2的配置文件")])]),s._v(" "),e("blockquote",[e("p",[s._v("修改agent2的配置文件")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/zabbix/zabbix_agent2.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041016817.png",alt:"image-20220304101654727"}})]),s._v(" "),e("p",[s._v("打开"),e("code",[s._v("HostnameItem=system.hostname")])]),s._v(" "),e("ul",[e("li",[s._v("检查文件")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -Ev "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^#|^$'")]),s._v(" /etc/zabbix/zabbix_agent2.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041018862.png",alt:"image-20220304101849759"}})]),s._v(" "),e("ul",[e("li",[s._v("改了配置记得重启zabbix-agent2")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart zabbix-agent2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("验证通信")])]),s._v(" "),e("p",[s._v("去zabbix-server的web界面，去配置注册动作，")]),s._v(" "),e("p",[s._v("菜单路径：配置->动作")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041020155.png",alt:"image-20220304102044081"}})]),s._v(" "),e("ul",[e("li",[s._v("配置动作")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041022213.png",alt:"image-20220304102228116"}})]),s._v(" "),e("p",[s._v("这里条件可以去掉")]),s._v(" "),e("ul",[e("li",[s._v("查看zabbix-server日志")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/zabbix/zabbix_server.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看zabbix-agent2日志")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/zabbix/zabbix_agent2.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"分布式监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分布式监控"}},[s._v("#")]),s._v(" 分布式监控")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041025981.png",alt:"image-20220304102545807"}})]),s._v(" "),e("blockquote",[e("p",[s._v("常规监控架构")])]),s._v(" "),e("ul",[e("li",[s._v("一台通过zabbix-server去监控多个zabbix-agent")]),s._v(" "),e("li",[s._v("如果都是同一个局域网，没什么问题，不存在网络安全等问题，不会存在网络延时")]),s._v(" "),e("li",[s._v("如果不是同一个局域网，跨数据中心，很可能存在高网络延时，以至于server以为agent宕机了")]),s._v(" "),e("li",[s._v("如果server宕机了，那就检测不到数据了，存在单点故障风险")]),s._v(" "),e("li",[s._v("1个server接收多个agent，压力较大")])]),s._v(" "),e("blockquote",[e("p",[s._v("分布式监控")])]),s._v(" "),e("ul",[e("li",[s._v("比如有500台linux，需要负债均衡到server端")]),s._v(" "),e("li",[s._v("通过zabbix-proxy的模式分区接收数据，保存自己本地的数据库当中，达到一定条件之后，汇总发给zabbix-server")]),s._v(" "),e("li",[s._v("zabbix-proxy还能解决网络延迟问题")])]),s._v(" "),e("p",[s._v("总结来说，分布式监控的作用：")]),s._v(" "),e("ul",[e("li",[s._v("分担server的集中式压力\n"),e("ul",[e("li",[s._v("agent->proxy->server")])])]),s._v(" "),e("li",[s._v("多机房之间的网络延时问题")])]),s._v(" "),e("h2",{attrs:{id:"部署分布式zabbix-proxy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署分布式zabbix-proxy"}},[s._v("#")]),s._v(" 部署分布式zabbix-proxy")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203041102826.png",alt:"image-20220304110207635"}})]),s._v(" "),e("blockquote",[e("p",[s._v("1、环境准备，准备3台机器")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.10 zabbix-server\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.11 zabbix-proxy\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.12 zabbix-agent2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("blockquote",[e("p",[s._v("2.在学习阶段，关闭防火墙")])]),s._v(" "),e("p",[s._v("3台机器都要关闭")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙规则链")]),s._v("\niptables -L\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("都是默认ACCEPT就行")]),s._v(" "),e("ul",[e("li",[s._v("显示当前SELinux的应用模式，是强制、执行还是停用。")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("getenforce\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("显示"),e("code",[s._v("disabled")]),s._v("就行")]),s._v(" "),e("blockquote",[e("p",[s._v("3、确保zabbix-agent自动发现、自动注册都没关闭")])]),s._v(" "),e("p",[s._v("之前开过了，就要关闭。")]),s._v(" "),e("blockquote",[e("p",[s._v("4、zabbix-server端无需变动，运行着就好")])]),s._v(" "),e("blockquote",[e("p",[s._v("5、配置zabbix-proxy服务器，并且部署数据库，用于存储agent2发来的数据，最终发给zabbix-server")])]),s._v(" "),e("ul",[e("li",[s._v("配置zabbix5.0的yum源")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh https://mirrors.aliyun.com/zabbix/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.e17.noarch.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("修改源地址")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#http://repo.zabbix.com#https://mirrors.aliyun.com/zabbix#'")]),s._v(" /etc/yum.repos.d/zabbix.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("6、安装proxy，以及数据库")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum install zabbix-proxy-mysql zabbix-get -y\nyum install mariadb-server mariadb -y\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("7、启动数据库，配置数据库用户，存储zabbix-agent2信息数据")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl start mariadb\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("检查是否启动成功，看3306端口是否在使用就知道了")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tunlp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("进入mysql，默认没有密码")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("mysql -uroot -p\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("创建数据库"),e("code",[s._v("zabbix_proxy")]),s._v("，注意结尾有分号")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("create database zabbix_proxy character "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" utf8 collate utf8_bin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("授予所有权限给zabbix_proxy，以及里面所有的表，验证密码都是zabbix")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("grant all privileges on zabbix_proxy.* to zabbix@"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),s._v(" identified by "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zabbix'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("说白了就是用户密码都是"),e("code",[s._v("zabbix")])]),s._v(" "),e("ul",[e("li",[s._v("刷新授权表")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("flush privileges"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("退出mysql")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("7、导入zabbix-proxy数据库信息")])]),s._v(" "),e("ul",[e("li",[s._v("查询sql文件在哪里")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ql zabbix-proxy-mysql\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203042201869.png",alt:"image-20220304220119696"}})]),s._v(" "),e("ul",[e("li",[s._v("把sql文件读取，通过管道写入到数据库里面")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("zcat /usr/share/doc/zabbix-proxy-mysql-5.0.6/schema.sql.gz "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql -uzabbix -pzabbix zabbix_proxy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("导入成功，检测一下")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("show databases"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nuse zabbix_proxy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nshow tables"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("会发现有166行记录，说明数据库基本配置完毕")]),s._v(" "),e("blockquote",[e("p",[s._v("8、修改zabbix-proxy配置文件，链接数据库的信息")])]),s._v(" "),e("ul",[e("li",[s._v("把162行写一个db，修改配置，并且做个.ori的备份文件")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i.ori "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'162a DBPassword=zabbix'")]),s._v(" /etc/zabbix/zabbix_proxy.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("配置zabbix-server端地址")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#Server=127.0.01#Server=10.0.1.50#'")]),s._v(" /etc/zabbix/zabbix_proxy.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("配置zabbix_proxy的hostname，注意这里是配置代理服务器的主机名")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#Hostname=Zabbix proxy#Hostname=zbz-agent04#'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("9、检查代理服务器的配置文件zabbix_proxy")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^[A-z]'")]),s._v(" /etc/zabbix/zabbix_proxy.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203042210523.png",alt:"image-20220304221005409"}})]),s._v(" "),e("blockquote",[e("p",[s._v("10、启动zabbix-proxy")])]),s._v(" "),e("p",[s._v("前面改过了zabbix-proxy的配置文件，要重启后才生效")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart zabbix-proxy\n\nsystemctl status zabbix-proxy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"web页面添加代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web页面添加代理"}},[s._v("#")]),s._v(" web页面添加代理")]),s._v(" "),e("p",[s._v("如何在zabbix-server端web页面添加代理")]),s._v(" "),e("p",[s._v("菜单路径：管理->agent代理程序->创建agent代理程序")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("主动式，是指，客户端主动把数据发给服务端")])]),s._v(" "),e("li",[e("p",[s._v("添加完记得启用")])]),s._v(" "),e("li",[e("p",[s._v("查看zabbix-server服务端日志")])])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/zabbix/zabbix_server.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("最好在zabbix-server服务端解析代理")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/hosts\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203042218808.png",alt:"image-20220304221805707"}})]),s._v(" "),e("ul",[e("li",[s._v("查看server端日志，当重启proxy时会立刻发送数据")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203042221583.png",alt:"image-20220304222008044"}})]),s._v(" "),e("h2",{attrs:{id:"agent使用proxy"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#agent使用proxy"}},[s._v("#")]),s._v(" agent使用proxy")]),s._v(" "),e("p",[s._v("首先去到zabbix-server的web界面，去配置agent代理，一定要确保"),e("strong",[s._v("主机的名字")]),s._v("和zabbix-proxy Linux物理机上的hostname相同，并且最近出现有数据，这才能是保证已经链接上了。")]),s._v(" "),e("blockquote",[e("p",[s._v("准备一台新的Linux")])]),s._v(" "),e("blockquote",[e("p",[s._v("安装好zabbix-agent2")])]),s._v(" "),e("blockquote",[e("p",[s._v("编辑zabbix-agent2的配置文件")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/zabbix/zabbix_agent2.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostname当前主机名字，等下要和zabbix-server那边添加的主机名字保持一致")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("zbx-agent-05\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改为zabbix-proxy的地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ServerActive")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.11\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 改为zabbix-proxy的地址")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Server")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.211")]),s._v(".55.11\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("确保你的信息要改正确")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^[z-Z]'")]),s._v(" /etc/zabbix/zabbix_agent2.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051003632.png",alt:"image-20220305100346527"}})]),s._v(" "),e("p",[s._v("修改完毕后，记得重启zabbix-agent2")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl restart zabbix-agent2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("现在去添加zabbix-agent2")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051002565.png",alt:"image-20220305100225438"}})]),s._v(" "),e("p",[s._v("一定要选代理程序")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051004632.png",alt:"image-20220305100443546"}})]),s._v(" "),e("p",[s._v("如果ZBX一直没有亮色，去关联一个模板")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051005799.png",alt:"image-20220305100516713"}})]),s._v(" "),e("blockquote",[e("p",[s._v("查看zabbix-proxy的日志")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f /var/log/zabbix/zabbix_proxy.log\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("也可以看得到，它检测到了zabbix-agent的加入")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051008600.png",alt:"image-20220305100800482"}})]),s._v(" "),e("p",[s._v("而且在zabbix-server端的小绿灯也亮了")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051009310.png",alt:"image-20220305100925177"}})]),s._v(" "),e("h2",{attrs:{id:"snmp监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#snmp监控"}},[s._v("#")]),s._v(" SNMP监控")]),s._v(" "),e("blockquote",[e("p",[s._v("前言")])]),s._v(" "),e("p",[s._v("我们目前的监控形式通过zabbix的形式去监控，都是检测Linux服务器，如果说需要监控打印机或者路由器，就无法使用zabbix-agent的方法去监控了，因为类似路由器无法安装zabbix-agent，但是网络设备都支持SNMP协议。")]),s._v(" "),e("blockquote",[e("p",[s._v("SNMP是简单网络管理协议")])]),s._v(" "),e("ul",[e("li",[s._v("1、zabbix-server安装snmp监控程序")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" net-snmp net-snmp-utils\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("2、开启snmp的配置，并且做好set文件的备份")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i.ori "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'57a view systemview included .1'")]),s._v(" /etc/snmp/snmpd.conf\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启服务")]),s._v("\nsysetemctl start snmpd.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("ul",[e("li",[s._v("3、使用snmp命令")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v指定snmp的版本，-c 暗号，127.9.9.1检测地址，sysname类似zabbix的key，也叫snmp的key")]),s._v("\nsnmp -v 2c -c public "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.9")]),s._v(".9.1 sysname\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051019299.png",alt:"image-20220305101922188"}})]),s._v(" "),e("p",[s._v("拿到Linux的主机名字了")]),s._v(" "),e("ul",[e("li",[s._v("4、在zabbix-server去监控snmp")])]),s._v(" "),e("p",[s._v("打开zabbix-server的配置")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051020419.png",alt:"image-20220305102030290"}})]),s._v(" "),e("p",[s._v("配置关联模板")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051021067.png",alt:"image-20220305102107956"}})]),s._v(" "),e("p",[s._v("查看zabbix-server的snmp地址和端口,其实默认端口是161，不过我们还是要查看一下")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("netsat -tunlp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://gitee.com/SaulJWu/blog-images/raw/master/202203051022275.png",alt:"image-20220305102257130"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);