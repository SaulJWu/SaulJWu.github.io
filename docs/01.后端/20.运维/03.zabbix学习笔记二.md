---
title: zabbix学习笔记二
date: 2022-02-28 14:21:28
permalink: /pages/e1cdbd/
categories:
  - 后端
  - 运维
tags:
  - 
---
## zabbix专有词汇

对于英文的掌握，是IT人员必须学习的技能，以下是zabbix必须掌握的一些关键词。

- zabbix server，服务端，收集数据，写入数据
- Item，对于某一个监控指标，称之为Items，如某台服务器的内存使用状况，就是一个item监控项
- Trigger，触发器，定义报警的逻辑，有正常，异常，未知三个状态
- Action，当Trigger符合设定值后，zabbix指定的动作，如发个邮件



## zabbix程序组件

- zabbix_server
- zabbix_agentd
- zabbix_proxy
- 



## 部署zabbix 5.0

### 部署zabbix服务端

> 1、准备机器，环境初始化

- 获取ip

```bash
ipconfig

ipconfig eth0

ipconfig eht0 |awk 'NR==2{print $2}'
```

- 关闭防火墙

```bash
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
systemctl disable --now firewalld
# 查看可接受流量
iptables -L
```



> 2、zabbix-server至少4G硬盘，尽量大一些。

- 查看硬盘

```bash
free -m
```



> 3、获取zabbix的下载源

```bash
# 查看仓库文件
ls /etc/yum.repos.d/
# 打开配置信息，改为阿里云
vim /etc/yum.repos.d/
```



> 4、更换zabix.repo为阿里云源

```bash
sed -i 's#http://repo.zabbix.com#https://mirros.aliyun.com/zabbix#' /etc/yum.repos.d/zabbix.repo
```

更换不会有反馈，需要自己打开配置文件查看

```bash
cat /etc/yum.repos.d/
```



> 5、清空yum旧缓存，下载zabbix服务端

```bash
yum clean all
yum makecache
yum install zabbix-server-mysql zabbix-agent -y
```



> 6、安装软件搜索器，可以在机器上使用多个版本的软件，并且不会影响到系统的依赖环境

```bash
yum install centos-release-scl -y^C
```



> 7、修改zabbix-front前端源，修改如下参数

```bash
vim /etc/yum.repos.d/
```

![image-20220228144306452](C:\Users\SaulJ\AppData\Roaming\Typora\typora-user-images\image-20220228144306452.png)

参数如下：

```bash
# 把enabled改为1
```



> 8、安装zabbix前端环境，且是安装到scl环境下

```bash
yum install zabbix-web-mysql-scl zabbix-apache-conf-scl -y
```



> 9、安装zabbix所需的数据，mariadb

```bash
yum install mariadb-server -y
```



> 10、配置数据库开机启动，并且立刻启动

```bash
systemctl enable --now mariadb
```



> 11、初始化数据库设置密码

```bash
systemctl status mariadb

# 设置密码，默认为空
mysql-secure-installation
# 是否要移除用户，是的
# 禁止root远程登录，否
```



> 12、添加数据库，并且添加zabbix专用用户

```bash
mysql -uroot -p

show databases;
# 创建数据库
create database zabbix character set utf8 collate utf_bin;
# 添加用户 localhost是指允许本机登录
create user zabbix@localhost identified by '你想要的密码';
# 授权
grant all privileges on zabbix.* to zabbix@localhost;
# 刷新授权表
flush privileges;
```



> 13、使用zabbix-mysql命令，导入数据库信息

```bash
zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -pzabbix zabbix
```

mysql -u后面是用户，-p是密码，空格后面是数据库名



导入完成后，进入数据库，查看有哪些表，检查是否导入成功

```bash
mysql -uroot -p

show databases;

use zabbix;

show tables;
```

如果导入成功的话，这些表都会创建成功。



> 14、修改zabbix-server配置文件，修改数据库的密码

```bash
vim /etc/zabbix/zabbix_server.conf
```

检查一下

```bash
grep '^DBPa' /etc/zabbix/zabbix_server.conf
```



> 15、修改zabbix的php配置文件，修改时区`Asia/Shanghai`

```bash
vim /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
```

检查一下

```bash
grep 'timezone' /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
```



> 16、启动zabbix相关服务器

```bash
systemctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm
systemctl enable zabbix-server zabbix-agent httpd rh-php72-php-fpm
```



> 17、访问zabbix入口

访问端口测试一下：

ip+`/zabbix`



![image-20220228164212913](https://gitee.com/SaulJWu/blog-images/raw/master/202202281644829.png)



配置数据库

![image-20220228164506883](https://gitee.com/SaulJWu/blog-images/raw/master/202202281645987.png)



细节设置

![image-20220228164524785](https://gitee.com/SaulJWu/blog-images/raw/master/202202281645871.png)



- 显示安装细节


![image-20220228164541870](https://gitee.com/SaulJWu/blog-images/raw/master/202202281645952.png)



安装成功

![image-20220228164557357](https://gitee.com/SaulJWu/blog-images/raw/master/202202281645448.png)



> 18、安装成功后默认账号密码

```bash
Admin
zabbix
```



> 19.设置zabbix网页端中文

- user-settings
- Language选择中文
- update



还有就是zabbix的仪表板，都可以自定义拖动组件和大小



### 部署zabbix客户端

zabbix5.0版本

agent新版本采用golang语言开发的客户端

由于是go语言开发，部署起来就很方便了，和之前的部署形式不一样了

agent2默认用10050端口，也就是zabbix客户端的端口

- 旧版本的客户端，zabbix-agent
- go语言新版客户端，zabbix-agent2



> 1.机器环境准备，2台zabbix客户端

- linux-2,zabbix-agent2
- linux-3,zabbix-agent2



> 2.注意时间正确

```bash
yum install ntpdate -y
ntpdate -u ntp.aliyun.com
```



> 3.时区的统一配置

```bash
date # 检查时间是否一致
mv /etc/lcaoltime{,.bak}
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
```





### 验证zaabix-agent2的连通性

```bash
```





### 解决zaabix-server查看的乱码问题

- 检测->主机,zabbix默认检测的就是它自己的服务端

zabbix默认检测了服务端本身，但是编码有问题

```bash
1.安装字体
yum -y install wqy-microhei-fonts

2.复制字体
\cp /usr/share/fonts/wqy-microhei/wqy-microhei.ttc /usr/share/fonts/dejavu/DejaVuSans.ttf
```



## 添加zabbix-agent主机

> 模板

- 我们添加监控项的时候可以直接使用模板，不需要每一个监控项都自己手动添加。
- 我们只需要选择模板

操作：菜单->报表->主机

1. 点击创建主机
   1. 主机名称：尽量和Linux hostname保持一致
   2. 可见的名称：在平台上看见的名称，为了通俗易懂，可以使用hostname+ip地址
   3. 群组：Linux servers，把当前加入到Linux主机群组
   4. 客户端Ip：填写IP
   5. DNS名称：不用管，没用到
   6. 端口：默认是10050
   7. 描述：备注信息
   8. 代理程序：不用管

创建完主机后，发现可用性那一列，没一个是绿色的，接下来需要操作：

1. 编辑主机
2. 选择模板
3. 输入Linux，自动搜索出许多模板
4. 可以使用`Template OS linux By Zabbix agent`

等待`ZBX`亮了之后，才算是正常的



## 自定义监控内容

