## 环境准备

### 前置要求

准备一台机子，安装好vagrant和VirtualBox

操作系统：Centos7.x-85 x64

硬件配置：

- CPU 2GB以上
- 内存 4G以上
- 硬盘30G以上
- 集群中所有机器之间网络互通
- 可以访问外网，需要拉取镜像
- 进制swap分区





### VirtualBox配置

#### 指定默认虚拟机位置

![image-20210630115118341](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630115118.png)

#### 创建网卡

![image-20210630115233574](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630115233.png)

![image-20210630115248908](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630115248.png)

#### 主机网络管理

能够相互ping通

![image-20210630115321415](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630115321.png)

### VagrantFile准备

~~~bash
Vagrant.configure("2") do |config|
	(1..3).each do |i|
		config.vm.define "k8s-node#{i}" do |node|
			# 设置虚拟机的Box
			node.vm.box = "centos/7"

			# 设置虚拟机的主机名
			node.vm.hostname="k8s-node#{i}"

			# 设置虚拟机的IP
			node.vm.network "private_network", ip: "192.168.56.#{100+i}", netmask: "255.255.255.0"

			# 设置主机与虚拟机的共享目录
			# node.vm.synced_folder "~/Documents/vagrant/share", "/home/vagrant/share"

			# VirtaulBox相关配置
			node.vm.provider "virtualbox" do |v|
				# 设置虚拟机的名称
				v.name = "k8s-node#{i}"
				# 设置虚拟机的内存大小
				#v.memory = 8192
				# 设置虚拟机的CPU个数
				#v.cpus = 4
			end
		end
	end
end
~~~



### 初始化虚拟机

#### 创建虚拟机

```bash
vagrant up
```

接下来慢慢下载虚拟机，慢慢创建三个节点，可以观察virtualBox

![image-20210630115558352](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630115558.png)

三个节点正常运行

#### 设置虚拟机可以通过ssh密码访问

```bash
vagrant ssh k8s-nod1
su root
# 密码也是vagrant
vi /etc/ssh/sshd_config
```

![image-20210630120013741](https://gitee.com/SaulJWu/blog-images/raw/master/images/20210630120013.png)

改为`yes`后，按`ESC`，然后输入`:wq`保存

```bash
service sshd restart
```

重启sshd，如果忘记了，重启虚拟机就可以了

因为我vagrant是从100+i开始，所以我k8s第一个节点的ip为101

所以shell连接`192.168.56.101`就可以了，然后把另外2个节点都改好可以通过shell连接。